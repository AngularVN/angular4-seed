machine:
  services:
    - docker
  node:
    version: 6.1.0

dependencies:
  # pre:
  #   - sudo apt-get update
  #   - sudo apt-get install -y curl git
  #   - sudo curl -sL https://deb.nodesource.com/setup_6.x | bash -
  #   - sudo apt-get update
  #   - sudo apt-get install -y nodejs
  override:
    - if [[ `npm -v` != 3* ]]; then npm i -g npm@3; fi
    - npm i

  cache_directories:   
    - "~/.npm"

test:
  override:    
    - npm run test


deployment:
  staging:
    branch: master
    commands:
      - npm run build
      - docker build -f Dockerfile -t angularvn/angular4-seed --rm=false .
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push angularvn/angular4-seed
 